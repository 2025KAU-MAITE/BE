<!DOCTYPE html>
<html>
<head>
    <title>ğŸ”¥ ì‹¤ì œ í† ìŠ¤í˜ì´ë¨¼ì¸  í…ŒìŠ¤íŠ¸</title>
    <meta charset="UTF-8">
    <script src="https://js.tosspayments.com/v1/payment"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; }
        .container { border: 2px solid #0064FF; padding: 20px; border-radius: 10px; }
        button { padding: 15px 30px; background: #0064FF; color: white; border: none; border-radius: 5px; font-size: 16px; cursor: pointer; }
        .info { background: #f5f5f5; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .step { margin: 10px 0; padding: 10px; background: #e8f4fd; border-radius: 5px; }
    </style>
</head>
<body>
<div class="container">
    <h1>ğŸ”¥ ì‹¤ì œ í† ìŠ¤í˜ì´ë¨¼ì¸  ì—°ë™ í…ŒìŠ¤íŠ¸</h1>

    <div class="info">
        <h3>ğŸ“‹ ìƒí’ˆ ì •ë³´</h3>
        <p><strong>ìƒí’ˆëª…:</strong> MAITE í”„ë¦¬ë¯¸ì—„ êµ¬ë…</p>
        <p><strong>ê¸ˆì•¡:</strong> 20,000ì›</p>
        <p><strong>ì„¤ëª…:</strong> ì‹¤ì œ í† ìŠ¤ì•±ìœ¼ë¡œ ê²°ì œ (í…ŒìŠ¤íŠ¸ ëª¨ë“œ - ëˆ ì•ˆë¹ ì§)</p>
    </div>

    <div class="step">
        <h4>1ë‹¨ê³„: JWT í† í° ì…ë ¥</h4>
        <input type="text" id="jwtToken" placeholder="Bearer í† í°ì„ ì…ë ¥í•˜ì„¸ìš”" style="width: 100%; padding: 10px;">
        <small>Swaggerì—ì„œ /auth/loginìœ¼ë¡œ í† í°ì„ ë¨¼ì € ë°œê¸‰ë°›ìœ¼ì„¸ìš”</small>
    </div>

    <div class="step">
        <h4>2ë‹¨ê³„: ê²°ì œ ì¤€ë¹„</h4>
        <button onclick="preparePayment()">ê²°ì œ ì •ë³´ ì¤€ë¹„í•˜ê¸°</button>
        <div id="prepareResult"></div>
    </div>

    <div class="step">
        <h4>3ë‹¨ê³„: ì‹¤ì œ í† ìŠ¤ì•± ê²°ì œ</h4>
        <button id="paymentButton" onclick="requestTossPayment()" disabled>ğŸš€ ì‹¤ì œ í† ìŠ¤ì•±ìœ¼ë¡œ ê²°ì œí•˜ê¸°</button>
    </div>
</div>

<script>
    const clientKey = 'test_ck_D5GePWvyJnrK0W0k6q8gLzN97Eoq'; // í† ìŠ¤ ê³µì‹ í…ŒìŠ¤íŠ¸ í‚¤
    const tossPayments = TossPayments(clientKey);
    let paymentData = null;

    // 1ë‹¨ê³„: ê²°ì œ ì¤€ë¹„
    async function preparePayment() {
        const token = document.getElementById('jwtToken').value;
        if (!token) {
            alert('JWT í† í°ì„ ì…ë ¥í•˜ì„¸ìš”!');
            return;
        }

        try {
            const response = await fetch('http://localhost:8080/toss/ready', {
                method: 'POST',
                headers: {
                    'Authorization': token.startsWith('Bearer ') ? token : 'Bearer ' + token,
                    'Content-Type': 'application/json'
                }
            });

            const result = await response.json();

            if (result.isSuccess) {
                paymentData = result.result;
                document.getElementById('prepareResult').innerHTML = `
                        <div style="color: green; margin-top: 10px;">
                            âœ… ê²°ì œ ì¤€ë¹„ ì™„ë£Œ!<br>
                            ğŸ“‹ ì£¼ë¬¸ID: ${paymentData.orderId}<br>
                            ğŸ’° ê¸ˆì•¡: ${paymentData.amount.toLocaleString()}ì›<br>
                            ğŸ‘¤ ê³ ê°ëª…: ${paymentData.customerName}<br>
                            ğŸŒ ì„±ê³µURL: ${paymentData.successUrl}
                        </div>
                    `;
                document.getElementById('paymentButton').disabled = false;
            } else {
                throw new Error(result.message);
            }
        } catch (error) {
            document.getElementById('prepareResult').innerHTML = `
                    <div style="color: red; margin-top: 10px;">
                        âŒ ì¤€ë¹„ ì‹¤íŒ¨: ${error.message}
                    </div>
                `;
        }
    }

    // 2ë‹¨ê³„: ì‹¤ì œ í† ìŠ¤ ê²°ì œì°½ ì˜¤í”ˆ
    async function requestTossPayment() {
        if (!paymentData) {
            alert('ë¨¼ì € ê²°ì œ ì¤€ë¹„ë¥¼ í•´ì£¼ì„¸ìš”!');
            return;
        }

        try {
            console.log('ğŸš€ ì‹¤ì œ í† ìŠ¤ ê²°ì œì°½ ì˜¤í”ˆ!', paymentData);

            // ğŸ”¥ ì‹¤ì œ í† ìŠ¤ì•± ê²°ì œì°½ ì˜¤í”ˆ (ì—¬ê¸°ì„œ ì§„ì§œ í† ìŠ¤ì•±ìœ¼ë¡œ ë„˜ì–´ê°!)
            await tossPayments.requestPayment('ì¹´ë“œ', {
                amount: paymentData.amount,
                orderId: paymentData.orderId,
                orderName: paymentData.orderName,
                customerName: paymentData.customerName,
                successUrl: paymentData.successUrl,
                failUrl: paymentData.failUrl,
            });

        } catch (error) {
            console.error('ê²°ì œ ì‹¤íŒ¨:', error);
            alert('ê²°ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
        }
    }
</script>
</body>
</html>